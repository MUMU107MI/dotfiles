#!/bin/bash
#
# @(#) : display bash script usage
#
# @version 0.0.3
# @author  Furukawa, Atsushi <atsushifx@gmail.com>
# @date    2022-07-02
# @license MIT
#
# @usage<<
#
# what <shellscript>
#
# display shell script usage
#
#<<

## initialize
set -euC -o pipefail
readonly SCRIPTDIR=$(
  cd $(dirname "$0")
  pwd
)
readonly WORKINGDIR=$(pwd)
# cd "$SCRIPTDIR"

## utility functionis

# output error message
_err() {
  echo "[ $0 $(date +'%Y-%m-%d %H:%M:%S') ]: $*" >&2
}

## main functions

###
# what
#  print oneline usage created bt '@(#)' comment
what_1line() {
  local _file="$1"

  local _cmd=$(basename "${_file}")
  local _ver=$(strings "${_file}" | grep '@version' | head -1 | awk '{print $3}')
  local _desc=$(strings "${_file}" | grep '@(#)' | head -1 | sed -e 's/[^.]*#)[ :]*//')

  echo "${_cmd} ( v$_ver ) : ${_desc}"
  return 0
}

##
# help
#
# create & print help message form header comment
#
what_desc() {
  local _file="$1"

  strings "${_file}" |
    sed -rn '/^#[ ]*@(usage|help|desc)/,/^##/{ p; }' |
    sed -e 's/^[# ]*//' |
    tail -n +2 |
    cat -s
}

## main
echo "What:"
what_1line "$0"

echo; echo "Description:"
what_desc "$0"

